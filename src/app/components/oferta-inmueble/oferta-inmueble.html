<!-- HEADER (fijo arriba) -->
<div class="fixed top-0 left-0 right-0 h-14 bg-red-900 z-50 flex items-center justify-center">
    <h1 class="text-white font-extrabold text-2xl tracking-wide">MIVIVIENDA INMOBILIARIA</h1>
</div>

<!-- SIDEBAR -->
<aside class="fixed top-14 left-0 bottom-0 w-32 bg-red-700 text-white z-40 flex flex-col items-center py-6 space-y-6">

    <!-- avatar -->
    <div class="w-full flex justify-center flex-none">
        <button mat-icon-button [matMenuTriggerFor]="menuUsuario" aria-label="Abrir men√∫ de usuario"
            class="rounded-full p-0 flex items-center justify-center focus:outline-none focus:ring-0 active:outline-none"
            style="width:60px;height:60px; box-shadow: none; border: none;">

            <mat-icon style="font-size:44px; width:44px; height:44px; color:white;">
                account_circle
            </mat-icon>
        </button>
    </div>

    <!-- menu -->
    <mat-menu #menuUsuario="matMenu">
        <button mat-menu-item (click)="irPerfil()"><mat-icon>person</mat-icon><span>Perfil</span></button>
        <button mat-menu-item (click)="logout()"><mat-icon>logout</mat-icon><span>Cerrar sesi√≥n</span></button>
    </mat-menu>


    <!-- 1Ô∏è‚É£ INMUEBLES -->
    <a routerLink="/oferta-inmueble" routerLinkActive="bg-red-900 border-l-4 border-white font-bold"
        class="w-full h-20 flex flex-col items-center justify-center hover:bg-red-600">

        <mat-icon class="text-white text-4xl leading-none">home</mat-icon>
        <span class="text-xs mt-1">Inmuebles</span>
    </a>


    <!-- 2Ô∏è‚É£ ENTIDAD FINANCIERA -->
    <a routerLink="/registrar-entidad-financiera" routerLinkActive="bg-red-900 border-l-4 border-white font-bold"
        class="w-full h-20 flex flex-col items-center justify-center hover:bg-red-600">

        <mat-icon class="text-white text-4xl leading-none">account_balance</mat-icon>
        <span class="text-xs mt-1">Entidad</span>
    </a>


    <!-- 3Ô∏è‚É£ CR√âDITO -->
    <a routerLink="/generar-credito" routerLinkActive="bg-red-900 border-l-4 border-white font-bold"
        class="w-full h-20 flex flex-col items-center justify-center hover:bg-red-600">

        <mat-icon class="text-white text-4xl leading-none">attach_money</mat-icon>
        <span class="text-xs mt-1">Cr√©dito</span>
    </a>


    <!-- 4Ô∏è‚É£ CRONOGRAMA (PLANES) -->
    <a routerLink="/generar-cronograma" routerLinkActive="bg-red-900 border-l-4 border-white font-bold"
        class="w-full h-20 flex flex-col items-center justify-center hover:bg-red-600">

        <mat-icon class="text-white text-4xl leading-none">event_note</mat-icon>
        <span class="text-xs mt-1">Cronograma</span>
    </a>

    <!-- NUEVO: FAQ -->
    <a routerLink="/preguntas-frecuentes" routerLinkActive="bg-red-900 border-l-4 border-white font-bold"
        class="w-full h-20 flex flex-col items-center justify-center hover:bg-red-600">
        <mat-icon class="text-white text-4xl">help_outline</mat-icon>
        <span class="text-xs mt-1">FAQ</span>
    </a>

</aside>


<!-- CONTENIDO PRINCIPAL (se desplaza por la izquierda con ml-32; debajo del header con mt-14) -->
<main class="ml-32 mt-14 pt-6 pb-8 min-h-screen bg-[#f6f5fa]">

    <!-- FILTROS: rect√°ngulo que se ajusta al contenido (no se expande de m√°s) -->
    <div class="w-full px-6 flex justify-start items-center gap-6 mt-2">
        <!-- T√çTULO -->
        <h1 class="text-2xl font-bold text-gray-800 whitespace-nowrap ml-40">
            OFERTAS INMUEBLES
        </h1>

        <div class="bg-white rounded-xl shadow-sm p-3 flex items-center gap-4">
            <input type="text" placeholder="Buscar departamento o distrito..."
                class="border rounded-lg px-4 py-2 w-[300px] min-w-[220px]" [(ngModel)]="filtroTexto"
                (input)="aplicarFiltros()" />


            <select class="border rounded-lg px-3 py-2 w-[185px]" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
                <option value="">Tipo de vivienda</option>
                <option value="SOSTENIBLE">Sostenible</option>
                <option value="TRADICIONAL">Tradicional</option>
                <option value="INTEGRADOR_TRADICIONAL">Integrador tradicional</option>
                <option value="INTEGRADOR_SOSTENIBLE">Integrador sostenible</option>
            </select>


            <select class="border rounded-lg px-3 py-2 w-[175px]" [(ngModel)]="filtroEstado"
                (change)="aplicarFiltros()">
                <option value="">Estado</option>
                <option value="CONSTRUIDO">Construido</option>
                <option value="EN_CONSTRUCCION">En construcci√≥n</option>
                <option value="TERRENO">Terreno unidades</option>
            </select>


            <select class="border rounded-lg px-3 py-2 w-[170px]" [(ngModel)]="filtroPrecio"
                (change)="aplicarFiltros()">
                <option value="">Precio</option>
                <option value="150000">Hasta S/ 150,000</option>
                <option value="300000">Hasta S/ 300,000</option>
                <option value="500000">Hasta S/ 500,000</option>
                <option value="500001">M√°s de S/ 500,000</option>
            </select>


            <select class="border rounded-lg px-3 py-2 w-[140px]" [(ngModel)]="filtroArea" (change)="aplicarFiltros()">
                <option value="">√Årea m√≠nima</option>
                <option value="40">Desde 40 m¬≤</option>
                <option value="60">Desde 60 m¬≤</option>
                <option value="80">Desde 80 m¬≤</option>
                <option value="100">Desde 100 m¬≤</option>
            </select>


        </div>
    </div>

    <!-- GRID DE INMUEBLES: 'cuadros' responsivos (1/2/3 columnas) -->
    <div class="px-6 mt-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

            <!-- tarjeta: repite con *ngFor -->
            <div *ngFor="let item of inmuebles"
                class="bg-white rounded-2xl shadow-md overflow-hidden border border-gray-200 flex flex-col">
                <!-- imagen superior (cubre todo ancho) -->
                <div class="w-full h-44 overflow-hidden">
                    <img [src]="item.imageUrl" alt="imagen" class="w-full h-full object-cover" />
                </div>

                <!-- contenido -->
                <div class="p-4 flex-1 flex flex-col">
                    <div class="text-[#008a4d] font-semibold text-lg">S/ {{ item.precioVenta | number }}</div>
                    <div class="text-gray-700 font-medium mt-2 text-sm">{{ item.direccion }} ‚Äì {{ item.distrito }}</div>
                    <div class="text-gray-500 text-xs mt-1">{{ item.areaM2 }} m¬≤ ¬∑ {{ item.departamento }} ¬∑ {{
                        item.provincia }}</div>

                    <p class="text-gray-600 text-sm mt-3">Tipo: {{ item.tipoVivienda | titlecase }}</p>

                    <!-- pie: estado y bot√≥n alineados al fondo -->
                    <div class="mt-auto flex items-center justify-between pt-4">

                        <!-- Estado -->
                        <span class="text-xs font-semibold px-2 py-1 rounded bg-black/70 text-white">
                            {{ item.estadoVivienda }}
                        </span>

                        <div class="flex items-center gap-2">

                            <!-- Bot√≥n editar -->
                            <button (click)="abrirPopup(item)"
                                class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-1">
                                <mat-icon style="font-size:18px">edit</mat-icon>
                            </button>

                            <!-- Bot√≥n financiar -->
                            <button (click)="financiar(item)"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                Financiar
                            </button>

                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
</main>

<!-- POPUP MODIFICAR INMUEBLE -->
<div *ngIf="mostrarPopup" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">

    <div class="bg-white rounded-2xl shadow-2xl p-8 w-[460px] relative animate-fadeIn">

        <!-- Bot√≥n cerrar -->
        <button (click)="cerrarPopup()"
            class="absolute top-4 right-4 text-gray-500 hover:text-red-600 transition text-lg">
            ‚úï
        </button>

        <!-- T√≠tulo -->
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
            Editar Inmueble
        </h2>

        <!-- CAMPOS -->
        <div class="space-y-4">

            <!-- Campo gen√©rico reutilizable -->
            <div>
                <label class="font-semibold text-gray-700">√Årea (m¬≤):</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.areaM2" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Direcci√≥n:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.direccion" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Distrito:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.distrito" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Provincia:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.provincia" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Departamento:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.departamento" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Tipo de Vivienda:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.tipoVivienda" readonly />
            </div>

            <div>
                <label class="font-semibold text-gray-700">Estado:</label>
                <input type="text" class="border rounded-lg px-3 py-2 w-full bg-gray-100 mt-1"
                    [value]="inmuebleEditando.estadoVivienda" readonly />
            </div>

            <!-- PRECIO MODIFICABLE -->
            <div>
                <label class="font-semibold text-gray-700">Precio de Venta (S/):</label>
                <input type="text" [(ngModel)]="nuevoPrecioTexto" (input)="validarPrecio()" (blur)="formatearAlSalir()"
                    class="border rounded-lg px-3 py-2 w-full text-right mt-1 focus:ring-2 focus:ring-blue-500"
                    placeholder="0.00" />
            </div>

        </div>

        <!-- BOT√ìN GUARDAR -->
        <button (click)="guardarPrecio()" class="w-full mt-7 bg-blue-600 text-white py-3 rounded-xl text-lg font-semibold
             hover:bg-blue-700 active:scale-[0.98] transition">
            Guardar Cambios
        </button>

    </div>
</div>

<!-- BOT√ìN FLOTANTE DEL ASISTENTE -->
<button class="fixed bottom-6 right-6 bg-red-700 text-white w-14 h-14 rounded-full shadow-xl 
hover:bg-red-800 flex items-center justify-center z-10" (click)="toggleAsistente()">
    <mat-icon>support_agent</mat-icon>
</button>

<!-- POPUP ASISTENTE -->
<div *ngIf="mostrarAsistente" class="fixed bottom-28 right-6 bg-white shadow-2xl w-96 rounded-2xl border p-5 z-50">

    <!-- T√≠tulo y bot√≥n cerrar -->
    <div class="flex justify-between items-center mb-3">
        <h3 class="font-bold text-xl text-red-700 flex items-center gap-2">
            <mat-icon>support_agent</mat-icon> Asistente T√©cnico
        </h3>
        <button (click)="toggleAsistente()" class="text-gray-500 hover:text-black text-lg">‚úï</button>
    </div>

    <p class="text-sm text-gray-700 mb-4">
        Te guiar√© para que encuentres el inmueble adecuado para ti:
    </p>

    <div class="space-y-4 text-sm">

        <!-- C√≥mo usar los filtros -->
        <div>
            <p class="font-bold text-gray-800">üîç C√≥mo usar los filtros</p>
            <ul class="list-disc pl-5 text-gray-600">
                <li>Busca por distrito, departamento o direcci√≥n.</li>
                <li>Filtra por tipo de vivienda: tradicional, sostenible o integrador.</li>
                <li>Filtra por estado de vivienda: construido, en construcci√≥n o terreno.</li>
                <li>El filtro de precio te ayuda a reducir opciones r√°pidamente.</li>
                <li>√Årea m√≠nima te permite buscar inmuebles m√°s amplios.</li>
            </ul>
        </div>

        <!-- Informaci√≥n importante -->
        <div>
            <p class="font-bold text-gray-800">üè† Informaci√≥n del inmueble</p>
            <ul class="list-disc pl-5 text-gray-600">
                <li>Verifica direcci√≥n, distrito y metraje.</li>
                <li>Revisa el estado del inmueble: construido, en construcci√≥n o terreno.</li>
                <li>El tipo de vivienda influye en el bono MiVivienda.</li>
            </ul>
        </div>

        <!-- Financiamiento -->
        <div>
            <p class="font-bold text-gray-800">üí≥ Antes de financiar</p>
            <ul class="list-disc pl-5 text-gray-600">
                <li>La opci√≥n ‚ÄúFinanciar‚Äù permite iniciar el proceso de simulaci√≥n del cr√©dito.</li>
                <li>En la siguiente pantalla podr√°s seleccionar una entidad financiera.</li>
                <li>Explora las alternativas para tomar la mejor decisi√≥n.</li>
            </ul>

        </div>

        <!-- Edici√≥n -->
        <div *ngIf="esAdmin">
            <p class="font-bold text-gray-800">üõ† Funciones de administrador</p>
            <ul class="list-disc pl-5 text-gray-600">
                <li>Puedes editar el precio de venta desde el √≠cono de l√°piz.</li>
                <li>La edici√≥n solo afecta al precio, no a los dem√°s datos.</li>
                <li>Los cambios se aplican inmediatamente en la lista.</li>
            </ul>
        </div>

    </div>

    <button class="w-full mt-5 bg-red-700 text-white py-2 rounded-xl hover:bg-red-800" (click)="toggleAsistente()">
        Entendido
    </button>

</div>